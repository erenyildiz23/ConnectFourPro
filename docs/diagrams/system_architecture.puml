@startuml system_architecture

title Connect Four System - Architecture Diagram

skinparam componentStyle uml2
skinparam defaultFontSize 11
skinparam ArrowThickness 2

' ========== CLIENT LAYER ==========
package "Client Layer" {
    
    component [Pygame GUI\nClient] as GUI {
        portin " " as gui_in
        portout " " as gui_out
    }
    
    note right of GUI
        **Technologies:**
        - Python 3.10+
        - Pygame 2.x
        - python-socketio
        - requests
        
        **Responsibilities:**
        - User interface
        - Local game rendering
        - Animation handling
        - AI game execution
    end note
}

' ========== NETWORK LAYER ==========
package "Network Layer" {
    
    component [REST API\nEndpoints] as REST {
        portin " " as rest_in
    }
    
    component [WebSocket\nHandler] as WS {
        portin " " as ws_in
    }
    
    note bottom of REST
        **/signup** - User registration
        **/login** - Authentication
        **/leaderboard** - Rankings
        **/active_games** - Lobby list
    end note
    
    note bottom of WS
        **create_game** - New room
        **join_game** - Enter room
        **make_move** - Game action
        **game_start/over** - Events
    end note
}

' ========== APPLICATION LAYER ==========
package "Application Layer" {
    
    component [Flask-SocketIO\nServer] as Server {
        portin " " as srv_in
        portout " " as srv_out
    }
    
    component [Game Room\nManager] as RoomMgr
    
    component [Game Engine\n(Bitboard)] as Engine
    
    component [AI Engine\n(Minimax + α-β)] as AI
    
    component [ELO Rating\nCalculator] as ELO
    
    Server --> RoomMgr
    Server --> Engine
    Server --> AI
    Server --> ELO
}

' ========== DATA LAYER ==========
package "Data Layer" {
    
    database "PostgreSQL\n(Production)" as PG {
    }
    
    database "SQLite\n(Development)" as SQLite {
    }
    
    component [Connection\nPool] as Pool
    
    Pool --> PG
    Pool --> SQLite
    
    note bottom of PG
        **Tables:**
        - users
        - game_records
        
        **Features:**
        - MVCC concurrency
        - Connection pooling
    end note
}

' ========== EXTERNAL SERVICES ==========
package "External Services" {
    
    cloud "ngrok\nTunnel" as ngrok
    
    note right of ngrok
        Enables internet
        multiplayer without
        static IP or port
        forwarding
    end note
}

' ========== CONNECTIONS ==========

gui_out -down-> rest_in : <<HTTPS>>\nStateless requests
gui_out -down-> ws_in : <<WSS>>\nReal-time events

rest_in -down-> srv_in
ws_in -down-> srv_in

srv_out -down-> Pool : SQL queries

GUI -right-> ngrok : Optional\nRemote access
ngrok -down-> Server

' ========== PROTOCOL DETAILS ==========

note as N1
    **Communication Protocols:**
    
    | Protocol | Use Case | Latency |
    |----------|----------|---------|
    | REST/HTTP | Auth, Leaderboard | ~2ms |
    | WebSocket | Game moves | ~1.5ms |
    
    **Hybrid Architecture Benefits:**
    - REST for stateless operations
    - WebSocket for real-time sync
    - Automatic fallback support
end note

@enduml
