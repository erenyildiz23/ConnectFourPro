@startuml class_diagram

title Connect Four System - Class Diagram

skinparam classAttributeIconSize 0
skinparam classFontSize 12
skinparam classAttributeFontSize 10

' ========== GAME CORE ==========
package "Game Core (game_core.py)" {
    
    class ConnectFourGame {
        - player1_board: int
        - player2_board: int
        - heights: List[int]
        - current_player: int
        - move_history: List[int]
        - game_over: bool
        - winner: int
        --
        + __init__()
        + make_move(col: int): bool
        + is_valid_location(col: int): bool
        + check_winner(): int
        + get_piece(row: int, col: int): int
        + get_valid_columns(): List[int]
        + copy(): ConnectFourGame
        + to_dict(): dict
        + from_dict(data: dict)
        - _check_direction(board: int, shift: int): bool
    }
    
    note right of ConnectFourGame
        Bitboard representation:
        49-bit integer per player
        (42 squares + 7 sentinel)
        
        Win detection: O(1)
        8 bitwise operations
    end note
}

' ========== AI ENGINE ==========
package "AI Engine (ai_vs_human.py)" {
    
    class AIEngine {
        - piece: int
        - opponent_piece: int
        - depth: int
        - nodes_evaluated: int
        - cutoffs: int
        --
        + __init__(piece: int, depth: int)
        + get_best_move(game: ConnectFourGame): int
        - minimax(game, depth, alpha, beta, maximizing): int
        - evaluate_position(game: ConnectFourGame): int
        - evaluate_window(window: List, piece: int): int
        - count_threats(game, piece): int
    }
    
    note bottom of AIEngine
        Time Complexity: O(b^d)
        With α-β: O(b^(d/2)) best case
        
        Depth 6 performance:
        - Avg latency: 355ms
        - Avg nodes: 11,400
        - Cutoff rate: 82%
    end note
}

' ========== SERVER ==========
package "Server (server.py)" {
    
    class FlaskApp <<Flask>> {
        + app: Flask
        + socketio: SocketIO
        --
        + route('/signup')
        + route('/login')
        + route('/leaderboard')
        + route('/active_games')
    }
    
    class SocketIOEvents {
        --
        + on_connect()
        + on_disconnect()
        + on_create_game(data)
        + on_join_game(data)
        + on_make_move(data)
    }
    
    class GameRoom {
        + room_id: str
        + player1_id: int
        + player2_id: int
        + game_state: ConnectFourGame
        + status: str
        + spectators: List[str]
        --
        + add_spectator(sid: str)
        + remove_spectator(sid: str)
        + is_full(): bool
    }
    
    FlaskApp -- SocketIOEvents : manages >
    SocketIOEvents "1" *-- "*" GameRoom : contains >
    GameRoom --> ConnectFourGame : uses >
}

' ========== DATABASE ==========
package "Database (database.py)" {
    
    class DatabaseManager {
        - connection_pool: Pool
        --
        + __init__(db_config: dict)
        + create_user(username, password): int
        + verify_user(username, password): dict
        + get_leaderboard(limit: int): List
        + update_elo(winner_id, loser_id)
        + save_game_result(data: dict)
        - _get_connection(): Connection
    }
    
    class User <<entity>> {
        + user_id: int <<PK>>
        + username: str <<unique>>
        + password_hash: str
        + rating: int
        + wins: int
        + losses: int
        + created_at: datetime
    }
    
    class GameRecord <<entity>> {
        + game_id: int <<PK>>
        + player1_id: int <<FK>>
        + player2_id: int <<FK>>
        + winner_id: int <<FK>>
        + moves: str
        + duration_ms: int
        + played_at: datetime
    }
    
    DatabaseManager --> User : manages >
    DatabaseManager --> GameRecord : manages >
    User "1" -- "*" GameRecord : plays >
}

' ========== GUI CLIENT ==========
package "GUI Client (gui_app.py)" {
    
    class GUI {
        - screen: Surface
        - network: NetworkClient
        - game_core: ConnectFourGame
        - ai_engine: AIEngine
        - game_state: str
        - status_message: str
        --
        + __init__()
        + run()
        - draw_board()
        - draw_game_over()
        - animate_drop(col, piece)
        - handle_events()
    }
    
    class NetworkClient {
        - sio: SocketIO
        - gui: GUI
        - connected: bool
        - user_data: dict
        --
        + __init__(gui: GUI)
        + login(username, password): bool
        + register(username, password): bool
        + connect_socket()
        + create(): void
        + join(room_id: str)
        + move(col: int)
        + get_leaderboard(): List
    }
    
    class Button {
        + rect: Rect
        + text: str
        + color: tuple
        --
        + draw(screen)
        + is_clicked(pos): bool
    }
    
    class InputBox {
        + rect: Rect
        + text: str
        + active: bool
        --
        + handle_event(event)
        + draw(screen)
    }
    
    GUI "1" *-- "1" NetworkClient
    GUI "1" *-- "1" ConnectFourGame
    GUI "1" *-- "0..1" AIEngine
    GUI "1" *-- "*" Button
    GUI "1" *-- "*" InputBox
}

' ========== RELATIONSHIPS ==========

NetworkClient ..> FlaskApp : HTTP requests
NetworkClient ..> SocketIOEvents : WebSocket events
FlaskApp --> DatabaseManager : uses >

@enduml
